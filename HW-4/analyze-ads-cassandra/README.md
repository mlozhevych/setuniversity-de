# Analyze Ads Cassandra

–¶–µ–π –ø—Ä–æ—î–∫—Ç —î ETL-–∫–æ–Ω–≤–µ—î—Ä–æ–º –¥–ª—è –∞–Ω–∞–ª—ñ–∑—É —Ä–µ–∫–ª–∞–º–Ω–∏—Ö –¥–∞–Ω–∏—Ö –∑ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è–º Apache Cassandra. –í—ñ–Ω –∑–∞–≤–∞–Ω—Ç–∞–∂—É—î –¥–∞–Ω—ñ –ø—Ä–æ
–∫–∞–º–ø–∞–Ω—ñ—ó, –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ —Ç–∞ –ø–æ–¥—ñ—ó –∑ CSV-—Ñ–∞–π–ª—ñ–≤, –æ–±—Ä–æ–±–ª—è—î —ó—Ö —ñ –∑–±–µ—Ä—ñ–≥–∞—î –≤ –¥–µ–Ω–æ—Ä–º–∞–ª—ñ–∑–æ–≤–∞–Ω–∏—Ö —Ç–∞–±–ª–∏—Ü—è—Ö Cassandra –¥–ª—è
–µ—Ñ–µ–∫—Ç–∏–≤–Ω–∏—Ö –∞–Ω–∞–ª—ñ—Ç–∏—á–Ω–∏—Ö –∑–∞–ø–∏—Ç—ñ–≤.

---

## üöÄ –ü–æ—á–∞—Ç–æ–∫ —Ä–æ–±–æ—Ç–∏

### –ü–µ—Ä–µ–¥—É–º–æ–≤–∏

- Python 3.9+
- Poetry ([—ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—è –∑—ñ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è](https://python-poetry.org/docs/#installing-with-pipx))
- Docker —Ç–∞ Docker Compose

### –ö—Ä–æ–∫–∏ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è

1. –ö–ª–æ–Ω—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ–π:
    ```bash
   git clone https://github.com/mlozhevych/setuniversity-de.git
   cd HW-4/analyze-ads-cassandra
   ```

2. –ù–∞–ª–∞—à—Ç—É–π—Ç–µ –∑–º—ñ–Ω–Ω—ñ —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞:

   –°—Ç–≤–æ—Ä—ñ—Ç—å —Ñ–∞–π–ª `.env` —É –∫–æ—Ä–µ–Ω–µ–≤—ñ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ—ó –ø—Ä–æ—î–∫—Ç—É. –¶–µ –Ω–µ–æ–±—Ö—ñ–¥–Ω–æ –¥–ª—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö —Ç–∞ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ Cassandra.
    ```
    GDRIVE_CAMPAIGNS_FILE_ID=<ID_–§–ê–ô–õ–£_GDRIVE_–ó_–ö–ê–ú–ü–ê–ù–Ü–Ø–ú–ò>
    GDRIVE_USERS_FILE_ID=<ID_–§–ê–ô–õ–£_GDRIVE_–ó_–ö–û–†–ò–°–¢–£–í–ê–ß–ê–ú–ò>
    GDRIVE_EVENTS_FILE_ID=<ID_–§–ê–ô–õ–£_GDRIVE_–ó_–ü–û–î–Ü–Ø–ú–ò>
   
    # –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è Cassandra (—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ñ –¥–ª—è Docker)
    CASSANDRA_HOST=127.0.0.1
    CASSANDRA_PORT=9042
    CASSANDRA_KEYSPACE=adtech
    ```
3. –í—Å—Ç–∞–Ω–æ–≤—ñ—Ç—å –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é Poetry:

   Poetry –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ —Å—Ç–≤–æ—Ä–∏—Ç—å –≤—ñ—Ä—Ç—É–∞–ª—å–Ω–µ —Å–µ—Ä–µ–¥–æ–≤–∏—â–µ —Ç–∞ –≤—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —É—Å—ñ –ø–∞–∫–µ—Ç–∏, –≤–∫–∞–∑–∞–Ω—ñ —É `pyproject.toml`.
   ```bash
   poetry install
   ```

## ‚öôÔ∏è –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è

### 1. –ó–∞–ø—É—Å—Ç—ñ—Ç—å Cassandra:

–ü—Ä–æ—î–∫—Ç –º—ñ—Å—Ç–∏—Ç—å —Ñ–∞–π–ª docker-compose.yml –¥–ª—è –ª–µ–≥–∫–æ–≥–æ –∑–∞–ø—É—Å–∫—É –±–∞–∑–∏ –¥–∞–Ω–∏—Ö.

```bash  
docker-compose up -d
```

### 2. –ó–∞–ø—É—Å—Ç—ñ—Ç—å —Å–∫—Ä–∏–ø—Ç–∏ ETL:

–£ —Ñ–∞–π–ª—ñ `pyproject.toml` –≤–∏–∑–Ω–∞—á–µ–Ω—ñ —Å–ø–µ—Ü—ñ–∞–ª—å–Ω—ñ —Å–∫—Ä–∏–ø—Ç–∏ –¥–ª—è –∑–∞–ø—É—Å–∫—É –æ—Å–Ω–æ–≤–Ω–∏—Ö –µ—Ç–∞–ø—ñ–≤ –∫–æ–Ω–≤–µ—î—Ä–∞ —á–µ—Ä–µ–∑ Poetry.

- –Ü–º–ø–æ—Ä—Ç "—Å–∏—Ä–∏—Ö" –¥–∞–Ω–∏—Ö:

  –¶—è –∫–æ–º–∞–Ω–¥–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç—å –¥–∞–Ω—ñ –∑ Google Drive —ñ –∑–±–µ—Ä–µ–∂–µ —ó—Ö —É –ø—Ä–æ–º—ñ–∂–Ω–∏—Ö —Ç–∞–±–ª–∏—Ü—è—Ö Cassandra.
   ```bash
    poetry run import_data
   ```
- –ó–∞–ø—É—Å–∫ –æ–∫—Ä–µ–º–∏—Ö ETL-—Å–∫—Ä–∏–ø—Ç—ñ–≤ –¥–ª—è –∞–Ω–∞–ª—ñ—Ç–∏—á–Ω–∏—Ö —Ç–∞–±–ª–∏—Ü—å:

  –í–∏ —Ç–∞–∫–æ–∂ –º–æ–∂–µ—Ç–µ –∑–∞–ø—É—Å–∫–∞—Ç–∏ –∫–æ–∂–µ–Ω ETL-—Å–∫—Ä–∏–ø—Ç –æ–∫—Ä–µ–º–æ –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∏—Ö –∞–Ω–∞–ª—ñ—Ç–∏—á–Ω–∏—Ö —Ç–∞–±–ª–∏—Ü—å.
   ```bash
    poetry run load_analytics_campaign_daily_metrics
    poetry run load_analytics_advertiser_spend
    poetry run load_analytics_user_engagement
    poetry run load_analytics_active_users
    poetry run load_analytics_advertiser_spend_by_region
   ```

_–ü—Ä–∏–º—ñ—Ç–∫–∞: poetry run –≤–∏–∫–æ–Ω—É—î –∫–æ–º–∞–Ω–¥–∏ —É –≤—ñ—Ä—Ç—É–∞–ª—å–Ω–æ–º—É —Å–µ—Ä–µ–¥–æ–≤–∏—â—ñ –ø—Ä–æ—î–∫—Ç—É._

## üóÇÔ∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ—î–∫—Ç—É —Ç–∞ —Å—Ö–µ–º–∞ –ë–î

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞

```
.
‚îú‚îÄ‚îÄ docker-compose.yml        # –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è Docker –¥–ª—è Cassandra
‚îú‚îÄ‚îÄ pyproject.toml            # –û—Å–Ω–æ–≤–Ω–∏–π —Ñ–∞–π–ª –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó Poetry
‚îú‚îÄ‚îÄ requirements.txt          # –°–ø–∏—Å–æ–∫ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π
‚îî‚îÄ‚îÄ src
    ‚îî‚îÄ‚îÄ analyze_ads_cassandra
        ‚îú‚îÄ‚îÄ cassandra_queries
        ‚îÇ   ‚îú‚îÄ‚îÄ ddl_queries.cql # DDL-–∑–∞–ø–∏—Ç–∏ –¥–ª—è —Ç–∞–±–ª–∏—Ü—å
        ‚îÇ   ‚îî‚îÄ‚îÄ dml_queries.cql # –ü—Ä–∏–∫–ª–∞–¥–∏ DML-–∑–∞–ø–∏—Ç—ñ–≤
        ‚îú‚îÄ‚îÄ etl_scripts           # ETL-—Å–∫—Ä–∏–ø—Ç–∏ –¥–ª—è –∞–Ω–∞–ª—ñ—Ç–∏—á–Ω–∏—Ö —Ç–∞–±–ª–∏—Ü—å
        ‚îÇ   ‚îú‚îÄ‚îÄ load_analytics_active_users.py
        ‚îÇ   ‚îú‚îÄ‚îÄ load_analytics_advertiser_spend.py
        ‚îÇ   ‚îú‚îÄ‚îÄ load_analytics_advertiser_spend_by_region.py
        ‚îÇ   ‚îú‚îÄ‚îÄ load_analytics_campaign_daily_metrics.py
        ‚îÇ   ‚îî‚îÄ‚îÄ load_analytics_user_engagement.py
        ‚îú‚îÄ‚îÄ import_data
        ‚îÇ   ‚îî‚îÄ‚îÄ load_raw.py     # –°–∫—Ä–∏–ø—Ç, —â–æ –≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è —á–µ—Ä–µ–∑ `import_data`
        ‚îî‚îÄ‚îÄ utils.py              # –î–æ–ø–æ–º—ñ–∂–Ω—ñ —Ñ—É–Ω–∫—Ü—ñ—ó
```

### –°—Ö–µ–º–∞ –ë–∞–∑–∏ –î–∞–Ω–∏—Ö

–ü—Ä–æ—î–∫—Ç –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î Cassandra –¥–ª—è –∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è –¥–∞–Ω–∏—Ö —É –¥–µ–∫—ñ–ª—å–∫–æ—Ö –¥–µ–Ω–æ—Ä–º–∞–ª—ñ–∑–æ–≤–∞–Ω–∏—Ö —Ç–∞–±–ª–∏—Ü—è—Ö –¥–ª—è —à–≤–∏–¥–∫–æ–≥–æ –¥–æ—Å—Ç—É–ø—É –¥–æ
–∞–Ω–∞–ª—ñ—Ç–∏—á–Ω–∏—Ö –∑—Ä—ñ–∑—ñ–≤. –ö–ª—é—á–æ–≤–∏–π –ø—Ä–æ—Å—Ç—ñ—Ä adtech —Å—Ç–≤–æ—Ä—é—î—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ.

#### –û—Å–Ω–æ–≤–Ω—ñ –∞–Ω–∞–ª—ñ—Ç–∏—á–Ω—ñ —Ç–∞–±–ª–∏—Ü—ñ:
![adtech.png](../../../docs/adtech.png)

`campaign_daily_metrics`

`top_advertisers_by_spend`

`user_engagement_history`

`top_users_by_clicks`

`top_advertisers_by_spend`