# Kafka Consumer

–¶–µ–π –ø—Ä–æ—î–∫—Ç —Ä–µ–∞–ª—ñ–∑—É—î Kafka consumer, —è–∫–∏–π –ø—ñ–¥–ø–∏—Å—É—î—Ç—å—Å—è –Ω–∞ —Ç–µ–º—É `tweets`, –∑—á–∏—Ç—É—î –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è, –æ–±—Ä–æ–±–ª—è—î —ó—Ö —ñ –∑–±–µ—Ä—ñ–≥–∞—î —É
CSV-—Ñ–∞–π–ª–∏, —â–æ —Å—Ç–≤–æ—Ä—é—é—Ç—å—Å—è —â–æ—Ö–≤–∏–ª–∏–Ω–∏.

–ü—Ä–æ—î–∫—Ç —î –ø—Ä–æ–¥–æ–≤–∂–µ–Ω–Ω—è–º [HW-8](../../HW-8/kafka-producer/README.md), –¥–µ –±—É–ª–æ —Ä–µ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ –ø—Ä–æ–¥—é—Å–µ—Ä, —â–æ –≥–µ–Ω–µ—Ä—É—î –¥–∞–Ω—ñ –ø—Ä–æ
—Ç–≤—ñ—Ç–∏.

---

## üõ†Ô∏è –¢–µ—Ö–Ω–æ–ª–æ–≥—ñ—ó

- **–ú–æ–≤–∞**: Python 3.9+

- **–ö–µ—Ä—É–≤–∞–Ω–Ω—è –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—è–º–∏:** Poetry

- **–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü—ñ—è:** Docker, Docker Compose

---

## üöÄ –ê—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞

–°–∏—Å—Ç–µ–º–∞ —Å–∫–ª–∞–¥–∞—î—Ç—å—Å—è –∑ —á–æ—Ç–∏—Ä—å–æ—Ö –æ—Å–Ω–æ–≤–Ω–∏—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ñ–≤, —è–∫—ñ –∑–∞–ø—É—Å–∫–∞—é—Ç—å—Å—è –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é Docker Compose:

Zookeeper: –ù–µ–æ–±—Ö—ñ–¥–Ω–∏–π –¥–ª—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ü—ñ—ó —Ä–æ–±–æ—Ç–∏ Kafka.

Kafka: –ë—Ä–æ–∫–µ—Ä –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å, —â–æ –ø—Ä–∏–π–º–∞—î —Ç–∞ –∑–±–µ—Ä—ñ–≥–∞—î –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è.

tweet-producer: –ü—Ä–æ–¥—é—Å–µ—Ä –∑ –ø–æ–ø–µ—Ä–µ–¥–Ω—å–æ–≥–æ –∑–∞–≤–¥–∞–Ω–Ω—è (HW-8), —è–∫–∏–π –≥–µ–Ω–µ—Ä—É—î —Ç–∞ –Ω–∞–¥—Å–∏–ª–∞—î –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è —É —Ç–µ–º—É `tweets`.

tweet-consumer: –ù–æ–≤–∏–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç (HW-9), —è–∫–∏–π –∑—á–∏—Ç—É—î –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –∑ —Ç–µ–º–∏ `tweets` —Ç–∞ –∑–±–µ—Ä—ñ–≥–∞—î —ó—Ö —É —Ñ–∞–π–ª–∏.

–î–∞–Ω—ñ (`author_id`, `created_at`, `text`) –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è —É CSV-—Ñ–∞–π–ª–∏ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ—ó `output_data`. –ù–æ–≤–∏–π —Ñ–∞–π–ª —Å—Ç–≤–æ—Ä—é—î—Ç—å—Å—è
—â–æ—Ö–≤–∏–ª–∏–Ω–∏ —É
—Ñ–æ—Ä–º–∞—Ç—ñ `tweets_dd_mm_yyyy_hh_mm.csv`.

---

## –®–≤–∏–¥–∫–∏–π —Å—Ç–∞—Ä—Ç

1. –°–∫–ª–æ–Ω—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ–π:

  ```bash
    git clone https://github.com/mlozhevych/setuniversity-de.git
    cd HW-9/kafka-consumer
  ```

2. –°—Ç–≤–æ—Ä—ñ—Ç—å —Ñ–∞–π–ª `.env` —É –∫–æ—Ä–µ–Ω—ñ –ø—Ä–æ—î–∫—Ç—É (`kafka-consumer/`).
3. –ù–∞–¥–∞–π—Ç–µ –ø—Ä–∞–≤–∞ –Ω–∞ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è —Å–∫—Ä–∏–ø—Ç—É –∑–∞–ø—É—Å–∫—É:
    ```bash
    chmod +x restart-kafka.sh
    ```
4. –ó–∞–ø—É—Å—Ç—ñ—Ç—å —É—Å—ñ —Å–µ—Ä–≤—ñ—Å–∏ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é —Å–∫—Ä–∏–ø—Ç–∞:
    ```bash
    ./restart-kafka.sh
    ```
   –¶—è –∫–æ–º–∞–Ω–¥–∞ –ø–æ–±—É–¥—É—î –æ–±—Ä–∞–∑–∏ —Ç–∞ –∑–∞–ø—É—Å—Ç–∏—Ç—å —É—Å—ñ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏ —É —Ñ–æ–Ω–æ–≤–æ–º—É —Ä–µ–∂–∏–º—ñ.

---

## ‚úÖ –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤

### 1. –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–∞–ø—É—â–µ–Ω–∏—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ñ–≤.

–©–æ–± –ø–µ—Ä–µ–∫–æ–Ω–∞—Ç–∏—Å—è, —â–æ –≤—Å—ñ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∏ —Å–∏—Å—Ç–µ–º–∏ –ø—Ä–∞—Ü—é—é—Ç—å, –≤–∏–∫–æ–Ω–∞–π—Ç–µ –∫–æ–º–∞–Ω–¥—É:

```bash
    docker ps
```

–í–∏ –ø–æ–≤–∏–Ω–Ω—ñ –ø–æ–±–∞—á–∏—Ç–∏ —á–æ—Ç–∏—Ä–∏ –∞–∫—Ç–∏–≤–Ω—ñ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏: `zookeeper`, `kafka`, `tweet-producer` —Ç–∞ `tweet-consumer:`
![docker-ps.png](docs/docker-ps.png)

### 2. –ü–µ—Ä–µ–≥–ª—è–¥ –ª–æ–≥—ñ–≤ —Å–ø–æ–∂–∏–≤–∞—á–∞ (consumer).

–©–æ–± —Å–ø–æ—Å—Ç–µ—Ä—ñ–≥–∞—Ç–∏ –∑–∞ —Ä–æ–±–æ—Ç–æ—é —Å–ø–æ–∂–∏–≤–∞—á–∞ –≤ —Ä–µ–∞–ª—å–Ω–æ–º—É —á–∞—Å—ñ, –≤–∏–∫–æ–Ω–∞–π—Ç–µ:

```bash
    docker-compose logs -f tweet-consumer
```

–í–∏ –ø–æ–≤–∏–Ω–Ω—ñ –±–∞—á–∏—Ç–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ —É—Å–ø—ñ—à–Ω–µ –∑—á–∏—Ç—É–≤–∞–Ω–Ω—è —Ç–∞ –∑–∞–ø–∏—Å –¥–∞–Ω–∏—Ö —É CSV-—Ñ–∞–π–ª–∏.

### 3. –ü–µ—Ä–µ–≥–ª—è–¥ –∑–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω–∏—Ö —Ñ–∞–π–ª—ñ–≤.

–ó–∞—á–µ–∫–∞–π—Ç–µ 10-15 —Ö–≤–∏–ª–∏–Ω, —â–æ–± —Å–∏—Å—Ç–µ–º–∞ –∑–≥–µ–Ω–µ—Ä—É–≤–∞–ª–∞ –¥–æ—Å—Ç–∞—Ç–Ω—å–æ –¥–∞–Ω–∏—Ö. –ü—ñ—Å–ª—è —Ü—å–æ–≥–æ –ø–µ—Ä–µ–≤—ñ—Ä—Ç–µ –≤–º—ñ—Å—Ç –¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ—ó `/app/data`:

```bash
   docker exec tweet-consumer ls -l /app/data
```

–í–∏ –ø–æ–±–∞—á–∏—Ç–µ —Å–ø–∏—Å–æ–∫ CSV-—Ñ–∞–π–ª—ñ–≤:

![docker-exec-tweet-consumer.png](docs/docker-exec-tweet-consumer.png)

–¶–µ –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂—É—î, —â–æ –ø—Ä–æ–≥—Ä–∞–º–∞ –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ —É—Å–ø—ñ—à–Ω–æ —Å—Ç–≤–æ—Ä—é—î —Ç–∞ –∑–∞–ø–∏—Å—É—î —Ñ–∞–π–ª–∏ —É —Å–≤–æ—é
–≤–Ω—É—Ç—Ä—ñ—à–Ω—é –¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ—é `/app/data`.

### 4. –ü–µ—Ä–µ–≥–ª—è–¥ –≤–º—ñ—Å—Ç—É —Ñ–∞–π–ª—É (–≤—Å–µ—Ä–µ–¥–∏–Ω—ñ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞).

–©–æ–± –ø–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ –¥–∞–Ω—ñ –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ –æ–¥–Ω–æ–≥–æ –∑ —Ñ–∞–π–ª—ñ–≤, —Ç–∞–∫–æ–∂ —Å–∫–æ—Ä–∏—Å—Ç–∞—î–º–æ—Å—è `docker exec` –¥–ª—è –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –∫–æ–º–∞–Ω–¥–∏ `cat` –≤
–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ñ:

```bash
   docker exec tweet-consumer cat /app/data/tweets_dd_mm_yyyy_hh_mm.csv
```

![cat.png](docs/cat.png)


**–ü—Ä–∏–º—ñ—Ç–∫–∞:** –Ω–µ –∑–∞–±—É–¥—å—Ç–µ –∑–∞–º—ñ–Ω–∏—Ç–∏ tweets_dd_mm_yyyy_hh_mm.csv –Ω–∞ —Ä–µ–∞–ª—å–Ω—É –Ω–∞–∑–≤—É —Ñ–∞–π–ª—É –∑—ñ —Å–ø–∏—Å–∫—É –≤–∏—â–µ

## üìÇ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ—î–∫—Ç—É

```
kafka-consumer/
‚îú‚îÄ‚îÄ data/                       
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îî‚îÄ‚îÄ consumer/
‚îÇ       ‚îú‚îÄ‚îÄ __init__.py
‚îÇ       ‚îú‚îÄ‚îÄ consumer.py
‚îÇ       ‚îî‚îÄ‚îÄ utils.py
‚îú‚îÄ‚îÄ docker-compose.yml
‚îú‚îÄ‚îÄ .env                        
‚îú‚îÄ‚îÄ Dockerfile
‚îú‚îÄ‚îÄ pyproject.toml
‚îú‚îÄ‚îÄ README.md
‚îî‚îÄ‚îÄ restart-kafka.sh
```